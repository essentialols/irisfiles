var gifenc=(()=>{var D=Object.defineProperty;var rt=Object.getOwnPropertyDescriptor;var nt=Object.getOwnPropertyNames;var at=Object.prototype.hasOwnProperty;var it=(t,e)=>{for(var i in e)D(t,i,{get:e[i],enumerable:!0})},lt=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of nt(e))!at.call(t,n)&&n!==i&&D(t,n,{get:()=>e[n],enumerable:!(r=rt(e,n))||r.enumerable});return t};var ot=t=>lt(D({},"__esModule",{value:!0}),t);var Ut={};it(Ut,{GIFEncoder:()=>tt,applyPalette:()=>gt,default:()=>Ct,nearestColor:()=>Mt,nearestColorIndex:()=>Z,nearestColorIndexWithDistance:()=>$,prequantize:()=>bt,quantize:()=>ht,snapColorsToPalette:()=>At});var ct={signature:"GIF",version:"89a",trailer:59,extensionIntroducer:33,applicationExtensionLabel:255,graphicControlExtensionLabel:249,imageSeparator:44,signatureSize:3,versionSize:3,globalColorTableFlagMask:128,colorResolutionMask:112,sortFlagMask:8,globalColorTableSizeMask:7,applicationIdentifierSize:8,applicationAuthCodeSize:3,disposalMethodMask:28,userInputFlagMask:2,transparentColorFlagMask:1,localColorTableFlagMask:128,interlaceFlagMask:64,idSortFlagMask:32,localColorTableSizeMask:7};function O(t=256){let e=0,i=new Uint8Array(t);return{get buffer(){return i.buffer},reset(){e=0},bytesView(){return i.subarray(0,e)},bytes(){return i.slice(0,e)},writeByte(n){r(e+1),i[e]=n,e++},writeBytes(n,a=0,l=n.length){r(e+l);for(let c=0;c<l;c++)i[e++]=n[c+a]},writeBytesView(n,a=0,l=n.byteLength){r(e+l),i.set(n.subarray(a,a+l),e),e+=l}};function r(n){var a=i.length;if(a>=n)return;var l=1024*1024;n=Math.max(n,a*(a<l?2:1.125)>>>0),a!=0&&(n=Math.max(n,256));let c=i;i=new Uint8Array(n),e>0&&i.set(c.subarray(0,e),0)}}var H=12,j=5003,ft=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function ut(t,e,i,r,n=O(512),a=new Uint8Array(256),l=new Int32Array(j),c=new Int32Array(j)){let w=l.length,u=Math.max(2,r);a.fill(0),c.fill(0),l.fill(-1);let f=0,o=0,h=u+1,B=h,y=!1,b=B,s=(1<<b)-1,A=1<<h-1,C=A+1,x=A+2,g=0,m=i[0],F=0;for(let M=w;M<65536;M*=2)++F;F=8-F,n.writeByte(u),v(A);let p=i.length;for(let M=1;M<p;M++)t:{let U=i[M],z=(U<<H)+m,k=U<<F^m;if(l[k]===z){m=c[k];break t}let R=k===0?1:w-k;for(;l[k]>=0;)if(k-=R,k<0&&(k+=w),l[k]===z){m=c[k];break t}v(m),m=U,x<1<<H?(c[k]=x++,l[k]=z):(l.fill(-1),x=A+2,y=!0,v(A))}return v(m),v(C),n.writeByte(0),n.bytesView();function v(M){for(f&=ft[o],o>0?f|=M<<o:f=M,o+=b;o>=8;)a[g++]=f&255,g>=254&&(n.writeByte(g),n.writeBytesView(a,0,g),g=0),f>>=8,o-=8;if((x>s||y)&&(y?(b=B,s=(1<<b)-1,y=!1):(++b,s=b===H?1<<b:(1<<b)-1)),M==C){for(;o>0;)a[g++]=f&255,g>=254&&(n.writeByte(g),n.writeBytesView(a,0,g),g=0),f>>=8,o-=8;g>0&&(n.writeByte(g),n.writeBytesView(a,0,g),g=0)}}}var st=ut;function Q(t,e,i){return t<<8&63488|e<<2&992|i>>3}function X(t,e,i,r){return t>>4|e&240|(i&240)<<4|(r&240)<<8}function Y(t,e,i){return t>>4<<8|e&240|i>>4}function V(t,e,i){return t<e?e:t>i?i:t}function q(t){return t*t}function J(t,e,i){var r=0,n=1e100;let a=t[e],l=a.cnt,c=a.ac,w=a.rc,u=a.gc,f=a.bc;for(var o=a.fw;o!=0;o=t[o].fw){let B=t[o],y=B.cnt,b=l*y/(l+y);if(!(b>=n)){var h=0;i&&(h+=b*q(B.ac-c),h>=n)||(h+=b*q(B.rc-w),!(h>=n)&&(h+=b*q(B.gc-u),!(h>=n)&&(h+=b*q(B.bc-f),!(h>=n)&&(n=h,r=o))))}}a.err=n,a.nn=r}function N(){return{ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0}}function wt(t,e){let i=e==="rgb444"?4096:65536,r=new Array(i),n=t.length;if(e==="rgba4444")for(let a=0;a<n;++a){let l=t[a],c=l>>24&255,w=l>>16&255,u=l>>8&255,f=l&255,o=X(f,u,w,c),h=o in r?r[o]:r[o]=N();h.rc+=f,h.gc+=u,h.bc+=w,h.ac+=c,h.cnt++}else if(e==="rgb444")for(let a=0;a<n;++a){let l=t[a],c=l>>16&255,w=l>>8&255,u=l&255,f=Y(u,w,c),o=f in r?r[f]:r[f]=N();o.rc+=u,o.gc+=w,o.bc+=c,o.cnt++}else for(let a=0;a<n;++a){let l=t[a],c=l>>16&255,w=l>>8&255,u=l&255,f=Q(u,w,c),o=f in r?r[f]:r[f]=N();o.rc+=u,o.gc+=w,o.bc+=c,o.cnt++}return r}function ht(t,e,i={}){let{format:r="rgb565",clearAlpha:n=!0,clearAlphaColor:a=0,clearAlphaThreshold:l=0,oneBitAlpha:c=!1}=i;if(!t||!t.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(t instanceof Uint8Array)&&!(t instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");let w=new Uint32Array(t.buffer),u=i.useSqrt!==!1,f=r==="rgba4444",o=wt(w,r),h=o.length,B=h-1,y=new Uint32Array(h+1);for(var b=0,s=0;s<h;++s){let d=o[s];if(d!=null){var A=1/d.cnt;f&&(d.ac*=A),d.rc*=A,d.gc*=A,d.bc*=A,o[b++]=d}}q(e)/b<.022&&(u=!1);for(var s=0;s<b-1;++s)o[s].fw=s+1,o[s+1].bk=s,u&&(o[s].cnt=Math.sqrt(o[s].cnt));u&&(o[s].cnt=Math.sqrt(o[s].cnt));var C,x,g;for(s=0;s<b;++s){J(o,s,!1);var m=o[s].err;for(x=++y[0];x>1&&(g=x>>1,!(o[C=y[g]].err<=m));x=g)y[x]=C;y[x]=s}var F=b-e;for(s=0;s<F;){for(var p;;){var v=y[1];if(p=o[v],p.tm>=p.mtm&&o[p.nn].mtm<=p.tm)break;p.mtm==B?v=y[1]=y[y[0]--]:(J(o,v,!1),p.tm=s);var m=o[v].err;for(x=1;(g=x+x)<=y[0]&&(g<y[0]&&o[y[g]].err>o[y[g+1]].err&&g++,!(m<=o[C=y[g]].err));x=g)y[x]=C;y[x]=v}var M=o[p.nn],U=p.cnt,z=M.cnt,A=1/(U+z);f&&(p.ac=A*(U*p.ac+z*M.ac)),p.rc=A*(U*p.rc+z*M.rc),p.gc=A*(U*p.gc+z*M.gc),p.bc=A*(U*p.bc+z*M.bc),p.cnt+=M.cnt,p.mtm=++s,o[M.bk].fw=M.fw,o[M.fw].bk=M.bk,M.mtm=B}let k=[];var R=0;for(s=0;;++R){let d=V(Math.round(o[s].rc),0,255),P=V(Math.round(o[s].gc),0,255),L=V(Math.round(o[s].bc),0,255),S=255;f&&(S=V(Math.round(o[s].ac),0,255),c&&(S=S<=(typeof c=="number"?c:127)?0:255),n&&S<=l&&(d=P=L=a,S=0));let _=f?[d,P,L,S]:[d,P,L];if(yt(k,_)||k.push(_),(s=o[s].fw)==0)break}return k}function yt(t,e){for(let i=0;i<t.length;i++){let r=t[i],n=r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2],a=r.length>=4&&e.length>=4?r[3]===e[3]:!0;if(n&&a)return!0}return!1}function T(t,e){var i=0,r;for(r=0;r<t.length;r++){let n=t[r]-e[r];i+=n*n}return i}function G(t,e){return e>1?Math.round(t/e)*e:t}function bt(t,{roundRGB:e=5,roundAlpha:i=10,oneBitAlpha:r=null}={}){let n=new Uint32Array(t.buffer);for(let a=0;a<n.length;a++){let l=n[a],c=l>>24&255,w=l>>16&255,u=l>>8&255,f=l&255;c=G(c,i),r&&(c=c<=(typeof r=="number"?r:127)?0:255),f=G(f,e),u=G(u,e),w=G(w,e),n[a]=c<<24|w<<16|u<<8|f<<0}}function gt(t,e,i="rgb565"){if(!t||!t.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(t instanceof Uint8Array)&&!(t instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");if(e.length>256)throw new Error("applyPalette() only works with 256 colors or less");let r=new Uint32Array(t.buffer),n=r.length,a=i==="rgb444"?4096:65536,l=new Uint8Array(n),c=new Array(a),w=i==="rgba4444";if(i==="rgba4444")for(let u=0;u<n;u++){let f=r[u],o=f>>24&255,h=f>>16&255,B=f>>8&255,y=f&255,b=X(y,B,h,o),s=b in c?c[b]:c[b]=pt(y,B,h,o,e);l[u]=s}else{let u=i==="rgb444"?Y:Q;for(let f=0;f<n;f++){let o=r[f],h=o>>16&255,B=o>>8&255,y=o&255,b=u(y,B,h),s=b in c?c[b]:c[b]=Bt(y,B,h,e);l[f]=s}}return l}function pt(t,e,i,r,n){let a=0,l=1e100;for(let c=0;c<n.length;c++){let w=n[c],u=w[3],f=I(u-r);if(f>l)continue;let o=w[0];if(f+=I(o-t),f>l)continue;let h=w[1];if(f+=I(h-e),f>l)continue;let B=w[2];f+=I(B-i),!(f>l)&&(l=f,a=c)}return a}function Bt(t,e,i,r){let n=0,a=1e100;for(let l=0;l<r.length;l++){let c=r[l],w=c[0],u=I(w-t);if(u>a)continue;let f=c[1];if(u+=I(f-e),u>a)continue;let o=c[2];u+=I(o-i),!(u>a)&&(a=u,n=l)}return n}function At(t,e,i=5){if(!t.length||!e.length)return;let r=t.map(l=>l.slice(0,3)),n=i*i,a=t[0].length;for(let l=0;l<e.length;l++){let c=e[l];c.length<a?c=[c[0],c[1],c[2],255]:c.length>a?c=c.slice(0,3):c=c.slice();let w=$(r,c.slice(0,3),T),u=w[0],f=w[1];f>0&&f<=n&&(t[u]=c)}}function I(t){return t*t}function Z(t,e,i=T){let r=1/0,n=-1;for(let a=0;a<t.length;a++){let l=t[a],c=i(e,l);c<r&&(r=c,n=a)}return n}function $(t,e,i=T){let r=1/0,n=-1;for(let a=0;a<t.length;a++){let l=t[a],c=i(e,l);c<r&&(r=c,n=a)}return[n,r]}function Mt(t,e,i=T){return t[Z(t,e,i)]}function tt(t={}){let{initialCapacity:e=4096,auto:i=!0}=t,r=O(e),n=5003,a=new Uint8Array(256),l=new Int32Array(n),c=new Int32Array(n),w=!1;return{reset(){r.reset(),w=!1},finish(){r.writeByte(ct.trailer)},bytes(){return r.bytes()},bytesView(){return r.bytesView()},get buffer(){return r.buffer},get stream(){return r},writeHeader:u,writeFrame(f,o,h,B={}){let{transparent:y=!1,transparentIndex:b=0,delay:s=0,palette:A=null,repeat:C=0,colorDepth:x=8,dispose:g=-1}=B,m=!1;if(i?w||(m=!0,u(),w=!0):m=!!B.first,o=Math.max(0,Math.floor(o)),h=Math.max(0,Math.floor(h)),m){if(!A)throw new Error("First frame must include a { palette } option");mt(r,o,h,A,x),K(r,A),C>=0&&kt(r,C)}let F=Math.round(s/10);xt(r,g,F,y,b);let p=!!A&&!m;vt(r,o,h,p?A:null),p&&K(r,A),dt(r,f,o,h,x,a,l,c)}};function u(){et(r,"GIF89a")}}function xt(t,e,i,r,n){t.writeByte(33),t.writeByte(249),t.writeByte(4),n<0&&(n=0,r=!1);var a,l;r?(a=1,l=2):(a=0,l=0),e>=0&&(l=e&7),l<<=2,t.writeByte(0|l|0|a),E(t,i),t.writeByte(n||0),t.writeByte(0)}function mt(t,e,i,r,n=8){let a=1,l=0,c=W(r.length)-1,w=a<<7|n-1<<4|l<<3|c;E(t,e),E(t,i),t.writeBytes([w,0,0])}function kt(t,e){t.writeByte(33),t.writeByte(255),t.writeByte(11),et(t,"NETSCAPE2.0"),t.writeByte(3),t.writeByte(1),E(t,e),t.writeByte(0)}function K(t,e){let i=1<<W(e.length);for(let r=0;r<i;r++){let n=[0,0,0];r<e.length&&(n=e[r]),t.writeByte(n[0]),t.writeByte(n[1]),t.writeByte(n[2])}}function vt(t,e,i,r){if(t.writeByte(44),E(t,0),E(t,0),E(t,e),E(t,i),r){let n=0,a=0,l=W(r.length)-1;t.writeByte(128|n|a|0|l)}else t.writeByte(0)}function dt(t,e,i,r,n=8,a,l,c){st(i,r,e,n,t,a,l,c)}function E(t,e){t.writeByte(e&255),t.writeByte(e>>8&255)}function et(t,e){for(var i=0;i<e.length;i++)t.writeByte(e.charCodeAt(i))}function W(t){return Math.max(Math.ceil(Math.log2(t)),1)}var Ct=tt;return ot(Ut);})();
